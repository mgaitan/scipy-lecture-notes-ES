

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.3.2. Numerical operations on arrays &mdash; Scipy lecture notes</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2012.3 (EuroScipy 2012)',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Scipy lecture notes" href="../../index.html" />
    <link rel="up" title="1.3. NumPy: creating and manipulating numerical data" href="index.html" />
    <link rel="next" title="1.3.3. More elaborate arrays" href="elaborate_arrays.html" />
    <link rel="prev" title="1.3.1. The numpy array object" href="array_object.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="elaborate_arrays.html" title="1.3.3. More elaborate arrays"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="array_object.html" title="1.3.1. The numpy array object"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Scipy lecture notes</a> &raquo;</li>
          <li><a href="../index.html" >1. Getting started with Python for science</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">1.3. NumPy: creating and manipulating numerical data</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="numerical-operations-on-arrays">
<h1>1.3.2. Numerical operations on arrays<a class="headerlink" href="#numerical-operations-on-arrays" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="section-contents">
<p class="topic-title first">Section contents</p>
<ul class="simple">
<li><a class="reference internal" href="#elementwise-operations" id="id2">Elementwise operations</a></li>
<li><a class="reference internal" href="#basic-reductions" id="id3">Basic reductions</a></li>
<li><a class="reference internal" href="#broadcasting" id="id4">Broadcasting</a></li>
<li><a class="reference internal" href="#array-shape-manipulation" id="id5">Array shape manipulation</a></li>
<li><a class="reference internal" href="#sorting-data" id="id6">Sorting data</a></li>
<li><a class="reference internal" href="#some-exercises" id="id7">Some exercises</a></li>
<li><a class="reference internal" href="#summary" id="id8">Summary</a></li>
</ul>
</div>
<div class="section" id="elementwise-operations">
<h2><a class="toc-backref" href="#id2">1.3.2.1. Elementwise operations</a><a class="headerlink" href="#elementwise-operations" title="Permalink to this headline">¶</a></h2>
<p>With scalars:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
<div class="newline"></div><span class="go">array([2, 3, 4, 5])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span><span class="o">**</span><span class="n">a</span>
<div class="newline"></div><span class="go">array([ 2,  4,  8, 16])</span>
<div class="newline"></div></pre></div>
</div>
<p>All arithmetic operates elementwise:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([-1.,  0.,  1.,  2.])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([ 2.,  4.,  6.,  8.])</span>
<div class="newline"></div></pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">j</span>
<div class="newline"></div><span class="go">array([ 2,  3,  6, 13, 28])</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Array multiplication is not matrix multiplication:</strong></p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">*</span> <span class="n">c</span>                   <span class="c"># NOT matrix multiplication!</span>
<div class="newline"></div><span class="go">array([[ 1.,  1.,  1.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  1.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  1.]])</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Matrix multiplication:</strong></p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([[ 3.,  3.,  3.],</span>
<div class="newline"></div><span class="go">       [ 3.,  3.,  3.],</span>
<div class="newline"></div><span class="go">       [ 3.,  3.,  3.]])</span>
<div class="newline"></div></pre></div>
</div>
</div>
<p>Comparisons:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([False,  True, False,  True], dtype=bool)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([False, False,  True, False], dtype=bool)</span>
<div class="newline"></div></pre></div>
</div>
<p>Logical operations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([ True,  True,  True, False], dtype=bool)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([ True, False, False, False], dtype=bool)</span>
<div class="newline"></div></pre></div>
</div>
<p>Shape mismatches:</p>
<div class="highlight-python"><pre>&gt;&gt;&gt; a = np.arange(4)
&gt;&gt;&gt; a
array([0, 1, 2, 3])
&gt;&gt;&gt; a + np.array([1, 2])    
Traceback (most recent call last):
File "&lt;stdin&gt;", line 1, in &lt;module&gt;
ValueError: shape mismatch: objects cannot be broadcast to a single shape</pre>
</div>
<p><strong>&#8216;Broadcast&#8217;?</strong> We&#8217;ll return to that <a class="reference internal" href="#broadcasting"><em>later</em></a>.</p>
<p><strong>Transposition</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>   <span class="c"># see help(np.triu)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[ 0.,  1.,  1.],</span>
<div class="newline"></div><span class="go">       [ 0.,  0.,  1.],</span>
<div class="newline"></div><span class="go">       [ 0.,  0.,  0.]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">T</span>
<div class="newline"></div><span class="go">array([[ 0.,  0.,  0.],</span>
<div class="newline"></div><span class="go">       [ 1.,  0.,  0.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  0.]])</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Linear algebra</strong></p>
<p class="last">The sub-module <tt class="xref py py-mod docutils literal"><span class="pre">np.linalg</span></tt> implements basic linear algebra, such as
solving linear systems, singular value decomposition, etc. However, it is
not guaranteed to be compiled using efficient routines, and thus we
recommend the use of <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/linalg.html#scipy.linalg" title="(in SciPy v0.11)"><tt class="xref py py-mod docutils literal"><span class="pre">scipy.linalg</span></tt></a>, as detailed in section
<a class="reference internal" href="../scipy.html#scipy-linalg"><em>Linear algebra operations: scipy.linalg</em></a></p>
</div>
<div class="green topic">
<p class="topic-title first">Exercise</p>
<p>Generate arrays <tt class="xref py py-obj docutils literal"><span class="pre">[2**0,</span> <span class="pre">2**1,</span> <span class="pre">2**2,</span> <span class="pre">2**3,</span> <span class="pre">2**4]</span></tt> and
<tt class="xref py py-obj docutils literal"><span class="pre">a_j</span> <span class="pre">=</span> <span class="pre">2^(3*j)</span> <span class="pre">-</span> <span class="pre">j</span></tt></p>
</div>
</div>
<div class="section" id="basic-reductions">
<h2><a class="toc-backref" href="#id3">1.3.2.2. Basic reductions</a><a class="headerlink" href="#basic-reductions" title="Permalink to this headline">¶</a></h2>
<p>Computing sums:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<div class="newline"></div><span class="go">10</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<div class="newline"></div><span class="go">10</span>
<div class="newline"></div></pre></div>
</div>
<img alt="../../_images/reductions.png" class="align-right" src="../../_images/reductions.png" />
<p>Sum by rows and by columns:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<div class="newline"></div><span class="go">array([[1, 1],</span>
<div class="newline"></div><span class="go">       [2, 2]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   <span class="c"># columns (first dimension)</span>
<div class="newline"></div><span class="go">array([3, 3])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<div class="newline"></div><span class="go">(3, 3)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c"># rows (second dimension)</span>
<div class="newline"></div><span class="go">array([2, 4])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<div class="newline"></div><span class="go">(2, 4)</span>
<div class="newline"></div></pre></div>
</div>
<p>Same idea in higher dimensions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>     
<div class="newline"></div><span class="go">1.14764...</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>     
<div class="newline"></div><span class="go">1.14764...</span>
<div class="newline"></div></pre></div>
</div>
<p><strong>Other reductions</strong> &#8212; works the same way (and take <tt class="docutils literal"><span class="pre">axis=</span></tt>)</p>
<ul>
<li><p class="first">Statistics:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<div class="newline"></div><span class="go">1.75</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<div class="newline"></div><span class="go">1.5</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c"># last axis</span>
<div class="newline"></div><span class="go">array([ 2.,  5.])</span>
<div class="newline"></div></pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>          <span class="c"># full population standard dev.</span>
<div class="newline"></div><span class="go">0.82915619758884995</span>
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">Extrema:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<div class="newline"></div><span class="go">1</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<div class="newline"></div><span class="go">3</span>
<div class="newline"></div></pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>  <span class="c"># index of minimum</span>
<div class="newline"></div><span class="go">0</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>  <span class="c"># index of maximum</span>
<div class="newline"></div><span class="go">1</span>
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">Logical operations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
<div class="newline"></div><span class="go">False</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
<div class="newline"></div><span class="go">True</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Can be used for array comparisons:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<div class="newline"></div><span class="go">False</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>
<div class="newline"></div><span class="go">True</span>
<div class="newline"></div></pre></div>
</div>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="p">((</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class="newline"></div><span class="go">True</span>
<div class="newline"></div></pre></div>
</div>
</div>
</li>
<li><p class="first">... and many more (best to learn as you go).</p>
</li>
</ul>
<div class="topic">
<p class="topic-title first">Example: data statistics</p>
<p>Data in <a class="reference download internal" href="../../_downloads/populations.txt"><tt class="xref download docutils literal"><span class="pre">populations.txt</span></tt></a>
describes the populations of hares and lynxes (and carrots) in northern
Canada during 20 years.</p>
<p>We can first plot the data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;data/populations.txt&#39;</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">carrots</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span>  <span class="c"># trick: columns to variables</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span> 
<div class="newline"></div><span class="go">&lt;matplotlib.axes.Axes object at ...&gt;</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">carrots</span><span class="p">)</span> 
<div class="newline"></div><span class="go">[&lt;matplotlib.lines.Line2D object at ...&gt;, ...]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s">&#39;Hare&#39;</span><span class="p">,</span> <span class="s">&#39;Lynx&#39;</span><span class="p">,</span> <span class="s">&#39;Carrot&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span> 
<div class="newline"></div><span class="go">&lt;matplotlib.legend.Legend object at ...&gt;</span>
<div class="newline"></div></pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_4.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_4.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_4.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_4.png" src="../../_images/numpy_intro_4.png" />
<p>The mean populations over time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([ 34080.95238095,  20166.66666667,  42400.        ])</span>
<div class="newline"></div></pre></div>
</div>
<p>The sample standard deviations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([ 20897.90645809,  16254.59153691,   3322.50622558])</span>
<div class="newline"></div></pre></div>
</div>
<p>Which species has the highest population each year?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">populations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="go">array([2, 2, 0, 0, 1, 1, 2, 2, 2, 2, 2, 2, 0, 0, 0, 1, 2, 2, 2, 2, 2])</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="topic">
<p class="topic-title first">Example: diffusion simulation using a random walk algorithm</p>
<img alt="../../_images/random_walk.png" class="align-center" src="../../_images/random_walk.png" />
<p>What is the typical distance from the origin of a random walker after
<tt class="docutils literal"><span class="pre">t</span></tt> left or right jumps?</p>
<img alt="../../_images/random_walk_schema.png" class="align-center" src="../../_images/random_walk_schema.png" style="width: 100%;" />
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">n_stories</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c"># number of walkers</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">t_max</span> <span class="o">=</span> <span class="mi">200</span>      <span class="c"># time during which we follow the walker</span>
<div class="newline"></div></pre></div>
</div>
<p>We randomly choose all the steps 1 or -1 of the walk:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_max</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">steps</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">n_stories</span><span class="p">,</span> <span class="n">t_max</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="c"># Verification: all steps are 1 or -1</span>
<div class="newline"></div><span class="go">array([-1,  1])</span>
<div class="newline"></div></pre></div>
</div>
<p>We build the walks by summing steps along the time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c"># axis = 1: dimension of time</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">sq_distance</span> <span class="o">=</span> <span class="n">positions</span><span class="o">**</span><span class="mi">2</span>
<div class="newline"></div></pre></div>
</div>
<p>We get the mean in the axis of the stories:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mean_sq_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sq_distance</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<p>Plot the results:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> 
<div class="newline"></div><span class="go">&lt;matplotlib.figure.Figure object at ...&gt;</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_sq_distance</span><span class="p">),</span> <span class="s">&#39;g.&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&#39;y-&#39;</span><span class="p">)</span> 
<div class="newline"></div><span class="go">[&lt;matplotlib.lines.Line2D object at ...&gt;, &lt;matplotlib.lines.Line2D object at ...&gt;]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&quot;$t$&quot;</span><span class="p">)</span> 
<div class="newline"></div><span class="go">&lt;matplotlib.text.Text object at ...&gt;</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">r&quot;$\sqrt{\langle (\delta x)^2 \rangle}$&quot;</span><span class="p">)</span> 
<div class="newline"></div><span class="go">&lt;matplotlib.text.Text object at ...&gt;</span>
<div class="newline"></div></pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_5.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_5.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_5.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_5.png" src="../../_images/numpy_intro_5.png" />
</div>
<p>The RMS distance grows as the square root of the time!</p>
</div>
<div class="section" id="broadcasting">
<span id="id1"></span><h2><a class="toc-backref" href="#id4">1.3.2.3. Broadcasting</a><a class="headerlink" href="#broadcasting" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Basic operations on <tt class="docutils literal"><span class="pre">numpy</span></tt> arrays (addition, etc.) are elementwise</p>
</li>
<li><p class="first">This works on arrays of the same size.</p>
<blockquote>
<div><div class="line-block">
<div class="line"><strong>Nevertheless</strong>, It&#8217;s also possible to do operations on arrays of different</div>
<div class="line">sizes if <em>Numpy</em> can transform these arrays so that they all have</div>
<div class="line">the same size: this conversion is called <strong>broadcasting</strong>.</div>
</div>
</div></blockquote>
</li>
</ul>
<p>The image below gives an example of broadcasting:</p>
<img alt="../../_images/numpy_broadcasting.png" class="align-center" src="../../_images/numpy_broadcasting.png" style="width: 100%;" />
<p>Let&#8217;s verify:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[ 0,  0,  0],</span>
<div class="newline"></div><span class="go">       [10, 10, 10],</span>
<div class="newline"></div><span class="go">       [20, 20, 20],</span>
<div class="newline"></div><span class="go">       [30, 30, 30]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([[ 0,  1,  2],</span>
<div class="newline"></div><span class="go">       [10, 11, 12],</span>
<div class="newline"></div><span class="go">       [20, 21, 22],</span>
<div class="newline"></div><span class="go">       [30, 31, 32]])</span>
<div class="newline"></div></pre></div>
</div>
<p>An useful trick:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(4,)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>  <span class="c"># adds a new axis -&gt; 2D array</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(4, 1)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[ 0],</span>
<div class="newline"></div><span class="go">       [10],</span>
<div class="newline"></div><span class="go">       [20],</span>
<div class="newline"></div><span class="go">       [30]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<div class="newline"></div><span class="go">array([[ 0,  1,  2],</span>
<div class="newline"></div><span class="go">       [10, 11, 12],</span>
<div class="newline"></div><span class="go">       [20, 21, 22],</span>
<div class="newline"></div><span class="go">       [30, 31, 32]])</span>
<div class="newline"></div></pre></div>
</div>
<p>We have already used broadcasting without knowing it!:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c"># we assign an array of dimension 0 to an array of dimension 1</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[ 2.,  2.,  2.,  2.,  2.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  1.,  1.,  1.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  1.,  1.,  1.],</span>
<div class="newline"></div><span class="go">       [ 1.,  1.,  1.,  1.,  1.]])</span>
<div class="newline"></div></pre></div>
</div>
<p>Broadcasting seems a bit magical, but it is actually quite natural to use it
when we want to solve a problem whose output data is an array with more
dimensions than input data.</p>
<div class="topic">
<p class="topic-title first">Example</p>
<p>Let&#8217;s construct an array of distances (in miles) between cities of
Route 66: Chicago, Springfield, Saint-Louis, Tulsa, Oklahoma City,
Amarillo, Santa Fe, Albuquerque, Flagstaff and Los Angeles.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mileposts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">736</span><span class="p">,</span> <span class="mi">871</span><span class="p">,</span> <span class="mi">1175</span><span class="p">,</span> <span class="mi">1475</span><span class="p">,</span> <span class="mi">1544</span><span class="p">,</span>
<div class="newline"></div><span class="gp">... </span>       <span class="mi">1913</span><span class="p">,</span> <span class="mi">2448</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">distance_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mileposts</span> <span class="o">-</span> <span class="n">mileposts</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">distance_array</span>
<div class="newline"></div><span class="go">array([[   0,  198,  303,  736,  871, 1175, 1475, 1544, 1913, 2448],</span>
<div class="newline"></div><span class="go">       [ 198,    0,  105,  538,  673,  977, 1277, 1346, 1715, 2250],</span>
<div class="newline"></div><span class="go">       [ 303,  105,    0,  433,  568,  872, 1172, 1241, 1610, 2145],</span>
<div class="newline"></div><span class="go">       [ 736,  538,  433,    0,  135,  439,  739,  808, 1177, 1712],</span>
<div class="newline"></div><span class="go">       [ 871,  673,  568,  135,    0,  304,  604,  673, 1042, 1577],</span>
<div class="newline"></div><span class="go">       [1175,  977,  872,  439,  304,    0,  300,  369,  738, 1273],</span>
<div class="newline"></div><span class="go">       [1475, 1277, 1172,  739,  604,  300,    0,   69,  438,  973],</span>
<div class="newline"></div><span class="go">       [1544, 1346, 1241,  808,  673,  369,   69,    0,  369,  904],</span>
<div class="newline"></div><span class="go">       [1913, 1715, 1610, 1177, 1042,  738,  438,  369,    0,  535],</span>
<div class="newline"></div><span class="go">       [2448, 2250, 2145, 1712, 1577, 1273,  973,  904,  535,    0]])</span>
<div class="newline"></div></pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/route66.png"><img alt="../../_images/route66.png" class="align-center" src="../../_images/route66.png" /></a>
</div>
<p>A lot of grid-based or network-based problems can also use
broadcasting. For instance, if we want to compute the distance from
the origin of points on a 10x10 grid, we can do:</p>
<div class="highlight-python"><pre>   &gt;&gt;&gt; x, y = np.arange(5), np.arange(5)
   &gt;&gt;&gt; distance = np.sqrt(x ** 2 + y[:, np.newaxis] ** 2)
   &gt;&gt;&gt; distance
   array([[ 0.        ,  1.        ,  2.        ,  3.        ,  4.        ],
          [ 1.        ,  1.41421356,  2.23606798,  3.16227766,  4.12310563],
          [ 2.        ,  2.23606798,  2.82842712,  3.60555128,  4.47213595],
          [ 3.        ,  3.16227766,  3.60555128,  4.24264069,  5.        ],
          [ 4.        ,  4.12310563,  4.47213595,  5.        ,  5.65685425]])

Or in color::

   &gt;&gt;&gt; plt.pcolor(distance)    # doctest: +ELLIPSIS
   &lt;matplotlib.collections.PolyCollection object at ...&gt;
   &gt;&gt;&gt; plt.colorbar()    # doctest: +ELLIPSIS
   &lt;matplotlib.colorbar.Colorbar instance at ...&gt;
   &gt;&gt;&gt; plt.axis('equal')
   (0.0, 200.0, 0.0, 16.0)</pre>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_6.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_6.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_6.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_6.png" src="../../_images/numpy_intro_6.png" />
<p><strong>Remark</strong> : the <tt class="docutils literal"><span class="pre">numpy.ogrid</span></tt> function allows to directly create vectors x
and y of the previous example, with two &#8220;significant dimensions&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<div class="newline"></div><span class="go">(array([[0],</span>
<div class="newline"></div><span class="go">       [1],</span>
<div class="newline"></div><span class="go">       [2],</span>
<div class="newline"></div><span class="go">       [3],</span>
<div class="newline"></div><span class="go">       [4]]), array([[0, 1, 2, 3, 4]]))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">((5, 1), (1, 5))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<p>So, <tt class="docutils literal"><span class="pre">np.ogrid</span></tt> is very useful as soon as we have to handle computations on a
grid. On the other hand, <tt class="docutils literal"><span class="pre">np.mgrid</span></tt> directly provides matrices full of
indices for cases where we can&#8217;t (or don&#8217;t want to) benefit from broadcasting:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<div class="newline"></div><span class="go">array([[0, 0, 0, 0],</span>
<div class="newline"></div><span class="go">       [1, 1, 1, 1],</span>
<div class="newline"></div><span class="go">       [2, 2, 2, 2],</span>
<div class="newline"></div><span class="go">       [3, 3, 3, 3]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<div class="newline"></div><span class="go">array([[0, 1, 2, 3],</span>
<div class="newline"></div><span class="go">       [0, 1, 2, 3],</span>
<div class="newline"></div><span class="go">       [0, 1, 2, 3],</span>
<div class="newline"></div><span class="go">       [0, 1, 2, 3]])</span>
<div class="newline"></div></pre></div>
</div>
<p>However, in practice, this is rarely needed!</p>
</div>
<div class="section" id="array-shape-manipulation">
<h2><a class="toc-backref" href="#id5">1.3.2.4. Array shape manipulation</a><a class="headerlink" href="#array-shape-manipulation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="flattening">
<h3>1.3.2.4.1. Flattening<a class="headerlink" href="#flattening" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<div class="newline"></div><span class="go">array([1, 2, 3, 4, 5, 6])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">T</span>
<div class="newline"></div><span class="go">array([[1, 4],</span>
<div class="newline"></div><span class="go">       [2, 5],</span>
<div class="newline"></div><span class="go">       [3, 6]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<div class="newline"></div><span class="go">array([1, 4, 2, 5, 3, 6])</span>
<div class="newline"></div></pre></div>
</div>
<p>Higher dimensions: last dimensions ravel out &#8220;first&#8221;.</p>
</div>
<div class="section" id="reshaping">
<h3>1.3.2.4.2. Reshaping<a class="headerlink" href="#reshaping" title="Permalink to this headline">¶</a></h3>
<p>The inverse operation to flattening:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(2, 3)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<div class="newline"></div><span class="go">array([[1, 2, 3],</span>
<div class="newline"></div><span class="go">       [4, 5, 6]])</span>
<div class="newline"></div></pre></div>
</div>
<p>Creating an array with a different shape, from another array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<div class="newline"></div><span class="go">array([[ 0,  1,  2,  3,  4,  5],</span>
<div class="newline"></div><span class="go">       [ 6,  7,  8,  9, 10, 11],</span>
<div class="newline"></div><span class="go">       [12, 13, 14, 15, 16, 17],</span>
<div class="newline"></div><span class="go">       [18, 19, 20, 21, 22, 23],</span>
<div class="newline"></div><span class="go">       [24, 25, 26, 27, 28, 29],</span>
<div class="newline"></div><span class="go">       [30, 31, 32, 33, 34, 35]])</span>
<div class="newline"></div></pre></div>
</div>
<p>Or,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>    <span class="c"># unspecified (-1) value is inferred</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="views-and-copies">
<h3>1.3.2.4.3. Views and copies<a class="headerlink" href="#views-and-copies" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">ndarray.reshape</span></tt> <strong>may</strong> return a view (cf <tt class="docutils literal"><span class="pre">help(np.reshape)</span></tt>)),
not a copy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([99,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,</span>
<div class="newline"></div><span class="go">       17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,</span>
<div class="newline"></div><span class="go">       34, 35])</span>
<div class="newline"></div></pre></div>
</div>
<p>Beware: reshape may also return a copy!</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[ 0.,  0.],</span>
<div class="newline"></div><span class="go">       [ 0.,  0.],</span>
<div class="newline"></div><span class="go">       [ 0.,  0.]])</span>
<div class="newline"></div></pre></div>
</div>
<p>To understand, see the section on <a class="reference internal" href="elaborate_arrays.html#memory-layout"><em>the memory layout of an array</em></a> below.</p>
</div>
<div class="section" id="dimension-shuffling">
<h3>1.3.2.4.4. Dimension shuffling<a class="headerlink" href="#dimension-shuffling" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(4, 3, 2)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<div class="newline"></div><span class="go">5</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="go">(3, 2, 4)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<div class="newline"></div><span class="go">5</span>
<div class="newline"></div></pre></div>
</div>
<p>Also creates a view:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<div class="newline"></div><span class="go">-1</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="resizing">
<h3>1.3.2.4.5. Resizing<a class="headerlink" href="#resizing" title="Permalink to this headline">¶</a></h3>
<p>Size of an array can be changed with <tt class="docutils literal"><span class="pre">ndarray.resize</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">8</span><span class="p">,))</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([0, 1, 2, 3, 0, 0, 0, 0])</span>
<div class="newline"></div></pre></div>
</div>
<p>However, it must not be referred to somewhere else:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">4</span><span class="p">,))</span>   
<div class="newline"></div><span class="gp">...</span>
<div class="newline"></div><span class="go">ValueError: cannot resize an array references or is referenced</span>
<div class="newline"></div><span class="go">by another array in this way.  Use the resize function</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="some-examples-of-real-world-use-cases">
<h3>1.3.2.4.6. Some examples of real-world use cases<a class="headerlink" href="#some-examples-of-real-world-use-cases" title="Permalink to this headline">¶</a></h3>
<div class="topic">
<p class="topic-title first">Case 2.a: Calling (legacy) Fortran code</p>
<p>Shape-preserving functions with elementwise non-Python
routines. For instance, Fortran</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="c">! 2_a_fortran_module.f90</span>
<div class="newline"></div><span class="k">subroutine </span><span class="nv">some_function</span><span class="p">(</span><span class="nv">n</span><span class="p">,</span> <span class="nv">a</span><span class="p">,</span> <span class="nv">b</span><span class="p">)</span>
<div class="newline"></div>  <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">n</span>
<div class="newline"></div>  <span class="kt">double precision</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="nv">n</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">in</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">a</span>
<div class="newline"></div>  <span class="kt">double precision</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="nv">n</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">out</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">b</span>
<div class="newline"></div>  <span class="nv">b</span> <span class="o">=</span> <span class="nv">a</span> <span class="o">+</span> <span class="mi">1</span>
<div class="newline"></div><span class="k">end subroutine </span><span class="nv">some_function</span>
<div class="newline"></div></pre></div>
</div>
<p>We can use f2py to wrap this fortran code in Python:
<tt class="docutils literal"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">fortran_module</span> <span class="pre">2_a_fortran_module.f90</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<div class="newline"></div><span class="kn">import</span> <span class="nn">fortran_module</span>
<div class="newline"></div>
<div class="newline"></div><span class="k">def</span> <span class="nf">some_function</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
<div class="newline"></div>    <span class="sd">&quot;&quot;&quot;</span>
<div class="newline"></div><span class="sd">    Call a Fortran routine, and preserve input shape</span>
<div class="newline"></div><span class="sd">    &quot;&quot;&quot;</span>
<div class="newline"></div>    <span class="nb">input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
<div class="newline"></div>    <span class="c"># fortran_module.some_function() takes 1-D arrays!</span>
<div class="newline"></div>    <span class="n">output</span> <span class="o">=</span> <span class="n">fortran_module</span><span class="o">.</span><span class="n">some_function</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
<div class="newline"></div>    <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<div class="newline"></div>
<div class="newline"></div><span class="k">print</span> <span class="n">some_function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<div class="newline"></div><span class="k">print</span> <span class="n">some_function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]))</span>
<div class="newline"></div>
<div class="newline"></div><span class="c"># -&gt;</span>
<div class="newline"></div><span class="c"># [ 2.  3.  4.]</span>
<div class="newline"></div><span class="c"># [[ 2.  3.]</span>
<div class="newline"></div><span class="c">#  [ 4.  5.]]</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="topic">
<p class="topic-title first">Case 2.b: Block matrices and vectors (and tensors)</p>
<p>Vector space: quantum level <img class="math" src="../../_images/math/b88c462e5d9319a7d2181ad94863658fa0a24736.png" alt="\otimes" style="vertical-align: -3px"/> spin</p>
<div class="math">
<p><img src="../../_images/math/d08f2718c597cbba158a44a4fc825136bec60a69.png" alt="\check{\psi}
=
\begin{pmatrix}
\hat{\psi}_1 \\ \hat{\psi}_2
\end{pmatrix}
\,,
\qquad
\hat{\psi}_{1} =
\begin{pmatrix}
  \psi_{1\uparrow} \\ \psi_{1\downarrow}
\end{pmatrix}
\qquad
\hat{\psi}_{2} =
\begin{pmatrix}
  \psi_{2\uparrow} \\ \psi_{2\downarrow}
\end{pmatrix}"/></p>
</div><p>In short: for <strong>block matrices and vectors</strong>, it can be useful
to preserve the <strong>block structure</strong>.</p>
<p>In Numpy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>   <span class="c"># dimensions: level, spin</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">psi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="c"># &lt;-- psi_{1,downarrow}</span>
<div class="newline"></div><span class="go">0.0</span>
<div class="newline"></div></pre></div>
</div>
<p>Linear operators on such block vectors have similar block structure:</p>
<div class="math">
<p><img src="../../_images/math/e6fa373bfd92f7d3e8f9543fea328d3240254df1.png" alt="\check{H} = \begin{pmatrix}
\hat{h}_{11} &amp; \hat{V} \\
\hat{V}^\dagger &amp; \hat{h}_{22} \\
\end{pmatrix}
\,,
\qquad
\hat{h}_{11}
=
\begin{pmatrix}
\epsilon_{1,\uparrow}
&amp; 0
\\
0 &amp; \epsilon_{1,\downarrow}
\end{pmatrix}
\,,
\qquad
\ldots"/></p>
</div><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="c"># dimensions: level1, level2, spin1, spin2</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">h_11</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">V</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<div class="newline"></div></pre></div>
</div>
<p>Doing the matrix product: get rid of the block structure, do the
4x4 matrix product, then put it back</p>
<div class="math">
<p><img src="../../_images/math/ea2a09651649a8aba90002fa152b91e59ff3c1d7.png" alt="\check{H}\check{\psi}"/></p>
</div><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">mdot</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="n">psi</span><span class="p">):</span>
<div class="newline"></div><span class="gp">... </span>    <span class="k">return</span> <span class="n">operator</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
<div class="newline"></div><span class="gp">... </span>               <span class="n">psi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<p>I.e., reorder dimensions first to <tt class="docutils literal"><span class="pre">level1,</span> <span class="pre">spin1,</span> <span class="pre">level2,</span> <span class="pre">spin2</span></tt>
and then reshape =&gt; correct matrix product.</p>
</div>
</div>
</div>
<div class="section" id="sorting-data">
<h2><a class="toc-backref" href="#id6">1.3.2.5. Sorting data</a><a class="headerlink" href="#sorting-data" title="Permalink to this headline">¶</a></h2>
<p>Sorting along an axis:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<div class="newline"></div><span class="go">array([[3, 4, 5],</span>
<div class="newline"></div><span class="go">       [1, 1, 2]])</span>
<div class="newline"></div></pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Sorts each row separately!</p>
</div>
<p>In-place sort:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<div class="newline"></div><span class="go">array([[3, 4, 5],</span>
<div class="newline"></div><span class="go">       [1, 1, 2]])</span>
<div class="newline"></div></pre></div>
</div>
<p>Sorting with fancy indexing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span>
<div class="newline"></div><span class="go">array([2, 3, 1, 0])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<div class="newline"></div><span class="go">array([1, 2, 3, 4])</span>
<div class="newline"></div></pre></div>
</div>
<p>Finding minima and maxima:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">j_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">j_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">j_max</span><span class="p">,</span> <span class="n">j_min</span>
<div class="newline"></div><span class="go">(0, 2)</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="section" id="some-exercises">
<h2><a class="toc-backref" href="#id7">1.3.2.6. Some exercises</a><a class="headerlink" href="#some-exercises" title="Permalink to this headline">¶</a></h2>
<div class="green topic">
<p class="topic-title first">Worked example: Framing Lena</p>
<p>Let&#8217;s do some manipulations on numpy arrays by starting with the
famous image of Lena (<a class="reference external" href="http://www.cs.cmu.edu/~chuck/lennapg/">http://www.cs.cmu.edu/~chuck/lennapg/</a>).
<tt class="docutils literal"><span class="pre">scipy</span></tt> provides a 2D array of this image with the <tt class="docutils literal"><span class="pre">scipy.lena</span></tt>
function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">misc</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">lena</span> <span class="o">=</span> <span class="n">misc</span><span class="o">.</span><span class="n">lena</span><span class="p">()</span>
<div class="newline"></div></pre></div>
</div>
<p><strong>Note:</strong> In older versions of scipy, you will find lena under
<tt class="xref py py-obj docutils literal"><span class="pre">scipy.lena()</span></tt></p>
<p>Here are a few images we will be able to obtain with our manipulations:
use different colormaps, crop the image, change some parts of the image.</p>
<img alt="../../_images/lenas.png" class="align-center" src="../../_images/lenas.png" />
<ul>
<li><p class="first">Let&#8217;s use the imshow function of pylab to display the image.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [3]: </span><span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<div class="newline"></div><span class="gp">In [4]: </span><span class="n">lena</span> <span class="o">=</span> <span class="n">misc</span><span class="o">.</span><span class="n">lena</span><span class="p">()</span>
<div class="newline"></div><span class="gp">In [5]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lena</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">Lena is then displayed in false colors. A colormap must be
specified for her to be displayed in grey.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [6]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lena</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">Create an array of the image with a narrower centering : for example,
remove 30 pixels from all the borders of the image. To check the result,
display this new array with <tt class="docutils literal"><span class="pre">imshow</span></tt>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [9]: </span><span class="n">crop_lena</span> <span class="o">=</span> <span class="n">lena</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">:</span><span class="o">-</span><span class="mi">30</span><span class="p">]</span>
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">We will now frame Lena&#8217;s face with a black locket. For this, we
need to create a mask corresponding to the pixels we want to be
black. The mask is defined by this condition <tt class="docutils literal"><span class="pre">(y-256)**2</span> <span class="pre">+</span>
<span class="pre">(x-256)**2</span></tt></p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [15]: </span><span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">]</span> <span class="c"># x and y indices of pixels</span>
<div class="newline"></div><span class="gp">In [16]: </span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
<div class="newline"></div><span class="gr">Out[16]: </span><span class="p">((</span><span class="mi">512</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">))</span>
<div class="newline"></div><span class="gp">In [17]: </span><span class="n">centerx</span><span class="p">,</span> <span class="n">centery</span> <span class="o">=</span> <span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span> <span class="c"># center of the image</span>
<div class="newline"></div><span class="gp">In [18]: </span><span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">centery</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">centerx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">230</span><span class="o">**</span><span class="mi">2</span> <span class="c"># circle</span>
<div class="newline"></div></pre></div>
</div>
<p>then we assign the value 0 to the pixels of the image corresponding
to the mask. The syntax is extremely simple and intuitive:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [19]: </span><span class="n">lena</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<div class="newline"></div><span class="gp">In [20]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lena</span><span class="p">)</span>
<div class="newline"></div><span class="gr">Out[20]: </span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">AxesImage</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0xa36534c</span><span class="o">&gt;</span>
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">Follow-up: copy all instructions of this exercise in a script called
<tt class="docutils literal"><span class="pre">lena_locket.py</span></tt> then execute this script in IPython with <tt class="docutils literal"><span class="pre">%run</span>
<span class="pre">lena_locket.py</span></tt>.</p>
<p>Change the circle to an ellipsoid.</p>
</li>
</ul>
</div>
<div class="green topic">
<p class="topic-title first">Exercise: Array manipulations</p>
<ol class="arabic">
<li><p class="first">Form the 2-D array (without typing it in explicitly):</p>
<div class="highlight-python"><pre>1  6 11
2  7 12
3  8 13
4  9 14
5 10 15</pre>
</div>
<p>and generate a new array containing its 2nd and 4th rows.</p>
</li>
<li><p class="first">Divide each column of the array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
<p>elementwise with the array <tt class="docutils literal"><span class="pre">b</span> <span class="pre">=</span> <span class="pre">np.array([1.,</span> <span class="pre">5,</span> <span class="pre">10,</span> <span class="pre">15,</span> <span class="pre">20])</span></tt>.
(Hint: <tt class="docutils literal"><span class="pre">np.newaxis</span></tt>).</p>
</li>
<li><p class="first">Harder one: Generate a 10 x 3 array of random numbers (in range [0,1]).
For each row, pick the number closest to 0.5.</p>
<ul class="simple">
<li>Use <tt class="docutils literal"><span class="pre">abs</span></tt> and <tt class="docutils literal"><span class="pre">argsort</span></tt> to find the column <tt class="docutils literal"><span class="pre">j</span></tt> closest for
each row.</li>
<li>Use fancy indexing to extract the numbers.  (Hint: <tt class="docutils literal"><span class="pre">a[i,j]</span></tt> &#8211;
the array <tt class="docutils literal"><span class="pre">i</span></tt> must contain the row numbers corresponding to stuff in
<tt class="docutils literal"><span class="pre">j</span></tt>.)</li>
</ul>
</li>
</ol>
</div>
<div class="green topic">
<p class="topic-title first">Exercise: Data statistics</p>
<p>The data in <a class="reference download internal" href="../../_downloads/populations.txt"><tt class="xref download docutils literal"><span class="pre">populations.txt</span></tt></a>::
describes the populations of hares and lynxes (and carrots) in
northern Canada during 20 years:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;data/populations.txt&#39;</span><span class="p">)</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">carrots</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span>  <span class="c"># trick: columns to variables</span>
<div class="newline"></div>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span> 
<div class="newline"></div><span class="go">&lt;matplotlib.axes.Axes object at ...&gt;</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">carrots</span><span class="p">)</span> 
<div class="newline"></div><span class="go">[&lt;matplotlib.lines.Line2D object at ...&gt;, ...]</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s">&#39;Hare&#39;</span><span class="p">,</span> <span class="s">&#39;Lynx&#39;</span><span class="p">,</span> <span class="s">&#39;Carrot&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span> 
<div class="newline"></div><span class="go">&lt;matplotlib.legend.Legend object at ...&gt;</span>
<div class="newline"></div></pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_7.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_7.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_7.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_7.png" src="../../_images/numpy_intro_7.png" />
<p>Computes and print, based on the data in <tt class="docutils literal"><span class="pre">populations.txt</span></tt>...</p>
<ol class="arabic simple">
<li>The mean and std of the populations of each species for the years
in the period.</li>
<li>Which year each species had the largest population.</li>
<li>Which species has the largest population for each year.
(Hint: <tt class="docutils literal"><span class="pre">argsort</span></tt> &amp; fancy indexing of
<tt class="docutils literal"><span class="pre">np.array(['H',</span> <span class="pre">'L',</span> <span class="pre">'C'])</span></tt>)</li>
<li>Which years any of the populations is above 50000.
(Hint: comparisons and <tt class="docutils literal"><span class="pre">np.any</span></tt>)</li>
<li>The top 2 years for each species when they had the lowest
populations. (Hint: <tt class="docutils literal"><span class="pre">argsort</span></tt>, fancy indexing)</li>
<li>Compare (plot) the change in hare population (see
<tt class="docutils literal"><span class="pre">help(np.gradient)</span></tt>) and the number of lynxes. Check correlation
(see <tt class="docutils literal"><span class="pre">help(np.corrcoef)</span></tt>).</li>
</ol>
<p>... all without for-loops.</p>
</div>
<div class="green topic">
<p class="topic-title first">Exercise: Crude integral approximations</p>
<p>Write a function <tt class="docutils literal"><span class="pre">f(a,</span> <span class="pre">b,</span> <span class="pre">c)</span></tt> that returns <img class="math" src="../../_images/math/3d7c9694dffca6866113f84e9c6a0980cf8ce047.png" alt="a^b - c" style="vertical-align: 0px"/>.  Form
a 24x12x6 array containing its values in parameter ranges <tt class="docutils literal"><span class="pre">[0,1]</span> <span class="pre">x</span>
<span class="pre">[0,1]</span> <span class="pre">x</span> <span class="pre">[0,1]</span></tt>.</p>
<p>Approximate the 3-d integral</p>
<div class="math">
<p><img src="../../_images/math/7057c0b4df82c2659d776bcdc0eb1c9e16f61f9f.png" alt="\int_0^1\int_0^1\int_0^1(a^b-c)da\,db\,dc"/></p>
</div><p>over this volume with the mean.  The exact result is: <img class="math" src="../../_images/math/13ff2c8691c09121c0bba41558b2ad22e55e077c.png" alt="\ln 2 -
\frac{1}{2}\approx0.1931\ldots" style="vertical-align: -10px"/> &#8212; what is your relative error?</p>
<p>(Hints: use elementwise operations and broadcasting.
You can make <tt class="docutils literal"><span class="pre">np.ogrid</span></tt> give a number of points in given range
with <tt class="docutils literal"><span class="pre">np.ogrid[0:1:20j]</span></tt>.)</p>
<p><strong>Reminder</strong> Python functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<div class="newline"></div>    <span class="k">return</span> <span class="n">some_result</span>
<div class="newline"></div></pre></div>
</div>
</div>
<div class="green topic">
<p class="topic-title first">Exercise: Mandelbrot set</p>
<blockquote>
<div><p>[<a class="reference external" href="../../plot_directive/intro/numpy/solutions/2_4_mandelbrot.py">source code</a>, <a class="reference external" href="../../plot_directive/intro/numpy/solutions/2_4_mandelbrot.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/intro/numpy/solutions/2_4_mandelbrot.pdf">pdf</a>]</p>
<img alt="../../_images/2_4_mandelbrot.png" src="../../_images/2_4_mandelbrot.png" />
<p>Write a script that computes the Mandelbrot fractal. The Mandelbrot
iteration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">N_max</span> <span class="o">=</span> <span class="mi">50</span>
<div class="newline"></div><span class="n">some_threshold</span> <span class="o">=</span> <span class="mi">50</span>
<div class="newline"></div>
<div class="newline"></div><span class="n">c</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1j</span><span class="o">*</span><span class="n">y</span>
<div class="newline"></div>
<div class="newline"></div><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N_max</span><span class="p">):</span>
<div class="newline"></div>    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span>
<div class="newline"></div></pre></div>
</div>
<p>Point (x, y) belongs to the Mandelbrot set if <img class="math" src="../../_images/math/ee71b080efbd8d38394b4e41eeb0b02b750ecfed.png" alt="|c|" style="vertical-align: -7px"/> &lt;
<tt class="docutils literal"><span class="pre">some_threshold</span></tt>.</p>
<p>Do this computation by:</p>
<ol class="arabic">
<li><p class="first">Construct a grid of c = x + 1j*y values in range [-2, 1] x [-1.5, 1.5]</p>
</li>
<li><p class="first">Do the iteration</p>
</li>
<li><p class="first">Form the 2-d boolean mask indicating which points are in the set</p>
</li>
<li><p class="first">Save the result to an image with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span> 
<div class="newline"></div><span class="go">&lt;matplotlib.image.AxesImage object at ...&gt;</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<div class="newline"></div><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;mandelbrot.png&#39;</span><span class="p">)</span>
<div class="newline"></div></pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="green topic">
<p class="topic-title first">Exercise: Markov chain</p>
<blockquote>
<div><img alt="../../_images/markov-chain.png" src="../../_images/markov-chain.png" />
<p>Markov chain transition matrix <tt class="docutils literal"><span class="pre">P</span></tt>, and probability distribution on
the states <tt class="docutils literal"><span class="pre">p</span></tt>:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">P[i,j]</span> <span class="pre">&lt;=</span> <span class="pre">1</span></tt>: probability to go from state <tt class="docutils literal"><span class="pre">i</span></tt> to state <tt class="docutils literal"><span class="pre">j</span></tt></li>
<li>Transition rule: <img class="math" src="../../_images/math/df72f26c7e5032305f8cdafc8cf3385cdc367f19.png" alt="p_{new} = P^T p_{old}" style="vertical-align: -6px"/></li>
<li><tt class="docutils literal"><span class="pre">all(sum(P,</span> <span class="pre">axis=1)</span> <span class="pre">==</span> <span class="pre">1)</span></tt>, <tt class="docutils literal"><span class="pre">p.sum()</span> <span class="pre">==</span> <span class="pre">1</span></tt>: normalization</li>
</ol>
<p>Write a script that works with 5 states, and:</p>
<ul class="simple">
<li>Constructs a random matrix, and normalizes each row so that it
is a transition matrix.</li>
<li>Starts from a random (normalized) probability distribution
<tt class="docutils literal"><span class="pre">p</span></tt> and takes 50 steps =&gt; <tt class="docutils literal"><span class="pre">p_50</span></tt></li>
<li>Computes the stationary distribution: the eigenvector of <tt class="docutils literal"><span class="pre">P.T</span></tt>
with eigenvalue 1 (numerically: closest to 1) =&gt; <tt class="docutils literal"><span class="pre">p_stationary</span></tt></li>
</ul>
<p>Remember to normalize the eigenvector &#8212; I didn&#8217;t...</p>
<ul class="simple">
<li>Checks if <tt class="docutils literal"><span class="pre">p_50</span></tt> and <tt class="docutils literal"><span class="pre">p_stationary</span></tt> are equal to tolerance 1e-5</li>
</ul>
<p>Toolbox: <tt class="docutils literal"><span class="pre">np.random.rand</span></tt>, <tt class="docutils literal"><span class="pre">.dot()</span></tt>, <tt class="docutils literal"><span class="pre">np.linalg.eig</span></tt>,
reductions, <tt class="docutils literal"><span class="pre">abs()</span></tt>, <tt class="docutils literal"><span class="pre">argmin</span></tt>, comparisons, <tt class="docutils literal"><span class="pre">all</span></tt>,
<tt class="docutils literal"><span class="pre">np.linalg.norm</span></tt>, etc.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id8">1.3.2.7. Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p><strong>What do you need to know to get started?</strong></p>
<ul>
<li><p class="first">Know how to create arrays : <tt class="docutils literal"><span class="pre">array</span></tt>, <tt class="docutils literal"><span class="pre">arange</span></tt>, <tt class="docutils literal"><span class="pre">ones</span></tt>,
<tt class="docutils literal"><span class="pre">zeros</span></tt>.</p>
</li>
<li><p class="first">Know the shape of the array with <tt class="docutils literal"><span class="pre">array.shape</span></tt>, then use slicing
to obtain different views of the array: <tt class="docutils literal"><span class="pre">array[::2]</span></tt>,
etc. Adjust the shape of the array using <tt class="docutils literal"><span class="pre">reshape</span></tt> or flatten it
with <tt class="docutils literal"><span class="pre">ravel</span></tt>.</p>
</li>
<li><p class="first">Obtain a subset of the elements of an array and/or modify their values
with masks:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<div class="newline"></div></pre></div>
</div>
</li>
<li><p class="first">Know miscellaneous operations on arrays, such as finding the mean or max
(<tt class="docutils literal"><span class="pre">array.max()</span></tt>, <tt class="docutils literal"><span class="pre">array.mean()</span></tt>). No need to retain everything, but
have the reflex to search in the documentation (online docs,
<tt class="docutils literal"><span class="pre">help()</span></tt>, <tt class="docutils literal"><span class="pre">lookfor()</span></tt>)!!</p>
</li>
<li><p class="first">For advanced use: master the indexing with arrays of integers, as well as
broadcasting. Know more Numpy functions to handle various array
operations.</p>
</li>
</ul>
<p><div style="clear: both"></div></p>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="elaborate_arrays.html" title="1.3.3. More elaborate arrays"
             >next</a></li>
        <li class="right" >
          <a href="array_object.html" title="1.3.1. The numpy array object"
             >previous</a> |</li>
        <li><a href="../../index.html">Scipy lecture notes</a> &raquo;</li>
          <li><a href="../index.html" >1. Getting started with Python for science</a> &raquo;</li>
          <li><a href="index.html" >1.3. NumPy: creating and manipulating numerical data</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>